<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1 initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tutorial. Grafo social Twitter con Riot y D3</title>
    <meta name="description" content="Tutorial. Grafo social Twitter con Riot y D3">
    <link rel="stylesheet" href=" /css/app.css ">
    <link rel="canonical" href="ivanheral.github.io/tutorial/2016/07/30/tutorial-grafo-twitter-con-riot-d3.html">
    <link rel="apple-touch-icon" sizes="57x57" href="/files/images/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/files/images/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/files/images/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/files/images/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/files/images/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/files/images/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/files/images/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/files/images/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/files/images/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/files/images/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/files/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/files/images/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/files/images/favicon/favicon-16x16.png">
    <link rel="manifest" href="/files/images/favicon/manifest.json">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <script type="text/javascript">
        var disqus_shortname = 'ivanheral';
        var disqus_identifier = "/tutorial/2016/07/30/tutorial-grafo-twitter-con-riot-d3.html";
    </script>
    <!-- Enables twitter cards on posts -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@ivanheral" />
<meta name="twitter:title" content="Tutorial. Grafo social Twitter con Riot y D3" />
<meta name="twitter:description" content="Tutorial. Grafo social Twitter con Riot y D3" />
<meta name="twitter:url" content="ivanheral.github.io/tutorial/2016/07/30/tutorial-grafo-twitter-con-riot-d3.html" />
<meta name="twitter:image" content="ivanheral.github.io/files/images/desarrollo/riot.jpg" />
</head>
<body>
    <div class="wrapper">
        <div class="container"><div class="tags">
    <div class="title">
        <a class="site-title" href="/">BLOG</a>
        <div id="search">
            <input id="search_input" type="text" placeholder="search..." maxlength="5">
        </div>
    </div>
    <div class="categories" id="links">
        <div class="link" id="cine">Cine
            <span>3</span>
        </div>
        <div class="link" id="random">Random
            <span>2</span>
        </div>
        <div class="link" id="opinion">Opinión
            <span>4</span>
        </div>
        <div class="link" id="tutorial">Tutorial
            <span>9</span>
        </div>
        <a class="link return" id="blog">Volver al post</a>
    </div>
</div>
<div class="post-list"></div>
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
<div class="article">
    <header class="elem important">
      <div class="wall_img">
      
      <img src="/files/images/desarrollo/riot.jpg"/>
      
      </div>
   <div class="info_post">
    <div class="post-title post" itemprop="name headline">Tutorial. Grafo social Twitter con Riot y D3</div>
    <div class="post-meta">
    <span itemprop="author" itemscope itemtype="http://schema.org/Person"></span><span itemprop="name">ivanheral,</span>
    <time datetime="2016-07-30T16:00:00+02:00" itemprop="datePublished"> 
30 
Julio
  
        2016</time>

       </div>
</div>
  </header>
    <div class="share-page">
    <div class="social-media-list">
        <a href="https://twitter.com/intent/tweet?text=Tutorial. Grafo social Twitter con Riot y D3&url=http://ivanheral.github.io/tutorial/2016/07/30/tutorial-grafo-twitter-con-riot-d3.html">
            <svg viewBox="0 0 32 32" fill="#1da1f2" width="36">
                <path d="M 16,2 C 8.2680079,2 2,8.2680053 2,16 2,23.731995 8.2680079,30 16,30 23.731992,30 30,23.731995 30,16 30,8.2680053 23.731992,2 16,2 Z" fill="#fff"></path>
                <path d="M 16,1 C 7.7157227,1 1,7.71572 1,16 1,24.28428 7.7157227,31 16,31 24.284277,31 31,24.28428 31,16 31,7.71572 24.284277,1 16,1 Z m 7.45541,11.17617 c 0.0074,0.165 0.01113,0.33094 0.01113,0.4977 0,5.0833 -3.869238,10.94496 -10.944844,10.94496 -2.172363,0 -4.1943748,-0.63686 -5.8967576,-1.7284 0.3009375,0.0357 0.6071484,0.0539 0.9176367,0.0539 1.8022852,0 3.4609569,-0.615 4.7774999,-1.64678 -1.68334,-0.0309 -3.1039452,-1.14316 -3.593496,-2.67141 0.2349024,0.0449 0.4758985,0.0691 0.72375,0.0691 0.3508594,0 0.690762,-0.0472 1.013438,-0.13506 -1.759688,-0.35349 -3.0857231,-1.90816 -3.0857231,-3.77197 0,-0.0162 0,-0.0323 3.5e-4,-0.0484 0.5185547,0.28811 1.1117579,0.46119 1.7422852,0.48118 -1.0321875,-0.68983 -1.7113477,-1.86727 -1.7113477,-3.20192 0,-0.705 0.1897266,-1.36582 0.5208985,-1.93389 1.8972656,2.32735 4.7317391,3.85875 7.9287311,4.01924 -0.06557,-0.2816 -0.09961,-0.57515 -0.09961,-0.87668 0,-2.12437 1.722421,-3.84662 3.846797,-3.84662 1.106425,0 2.10621,0.46711 2.807871,1.21471 0.876211,-0.17244 1.699454,-0.4926 2.442774,-0.93346 -0.287227,0.8983 -0.897188,1.65217 -1.691367,2.12824 0.778125,-0.093 1.519511,-0.29976 2.209336,-0.60568 -0.515451,0.77133 -1.167599,1.44885 -1.919356,1.99119 z"></path>
            </svg>
        </a>
        <a href="https://facebook.com/sharer.php?u=ivanheral.github.io/tutorial/2016/07/30/tutorial-grafo-twitter-con-riot-d3.html" rel="nofollow" target="_blank" title="Compartir en Facebook">
            <svg viewBox="0 0 32 32" fill="#3b5998" width="36">
                <path d="M 16,2 C 8.2680079,2 2,8.2680053 2,16 2,23.731995 8.2680079,30 16,30 23.731992,30 30,23.731995 30,16 30,8.2680053 23.731992,2 16,2 Z" fill="#fff"></path>
                <path d="M 16 1 C 7.7157227 1 1 7.71572 1 16 C 1 24.28428 7.7157227 31 16 31 C 24.284277 31 31 24.28428 31 16 C 31 7.71572 24.284277 1 16 1 z M 18.220703 8.9140625 L 19.433594 8.9140625 L 19.433594 10.189453 L 19.433594 11.462891 L 18.636719 11.472656 C 17.779565 11.483924 17.67147 11.497903 17.478516 11.595703 C 17.353545 11.659021 17.271471 11.750554 17.212891 11.896484 C 17.168061 12.009479 17.168333 12.03027 17.158203 12.873047 C 17.150928 13.346665 17.150391 13.7418 17.150391 13.75 C 17.153718 13.75825 17.674335 13.765625 18.306641 13.765625 L 19.457031 13.765625 L 19.445312 13.849609 C 19.439383 13.89588 19.379257 14.469009 19.310547 15.125 L 19.183594 16.320312 L 18.158203 16.320312 L 17.134766 16.320312 L 17.134766 19.703125 C 17.134766 21.563327 17.148438 23.085938 17.148438 23.085938 L 14.068359 23.085938 L 14.068359 20.007812 L 14.068359 16.320312 L 13.306641 16.320312 L 12.542969 16.320312 L 12.542969 15.042969 L 12.542969 13.765625 L 13.304688 13.765625 L 14.064453 13.765625 L 14.074219 12.730469 C 14.084268 11.66864 14.094057 11.525352 14.179688 11.103516 C 14.263218 10.691927 14.451439 10.255344 14.673828 9.9589844 C 15.112819 9.3740849 15.82538 9.031279 16.789062 8.9375 C 16.915264 8.925205 17.512171 8.9140625 18.220703 8.9140625 z"></path>
            </svg>
        </a>
        <a href="https://plus.google.com/share?url=ivanheral.github.io/tutorial/2016/07/30/tutorial-grafo-twitter-con-riot-d3.html" rel="nofollow" target="_blank" title="Compartir en Google+">
            <svg viewBox="0 0 32 32" fill="#dd4b39" width="36">
                <path d="M 16,2 C 8.2680079,2 2,8.2680053 2,16 2,23.731995 8.2680079,30 16,30 23.731992,30 30,23.731995 30,16 30,8.2680053 23.731992,2 16,2 Z" fill="#fff"></path>
                <path d="M 16,1 C 7.7148437,1 1,7.71484 1,16 1,24.28516 7.7148437,31 16,31 24.285156,31 31,24.28516 31,16 31,7.71484 24.285156,1 16,1 Z m -3.75,22.5 c -4.1484375,0 -7.5,-3.35156 -7.5,-7.5 0,-4.14844 3.3515625,-7.5 7.5,-7.5 2.027344,0 3.720703,0.73828 5.027344,1.96289 l -2.039063,1.95703 c -0.55664,-0.5332 -1.529297,-1.1543 -2.988281,-1.1543 -2.5605469,0 -4.6523438,2.1211 -4.6523438,4.73438 0,2.61328 2.0917969,4.73437 4.6523438,4.73437 2.970703,0 4.083984,-2.13281 4.253906,-3.23437 l -4.253906,0 0,-2.57227 7.083984,0 c 0.06445,0.375 0.117188,0.75 0.117188,1.24219 0,4.28906 -2.871094,7.33008 -7.201172,7.33008 z m 13.125,-7.5 0,1.875 -1.875,0 0,-1.875 -1.875,0 0,-1.875 1.875,0 0,-1.875 1.875,0 0,1.875 1.875,0 0,1.875 -1.875,0 z"></path>
            </svg>
        </a>
        <a href="whatsapp://send?text=ivanheral.github.io/tutorial/2016/07/30/tutorial-grafo-twitter-con-riot-d3.html" data-action="share/whatsapp/share" title="Compartir en Whatsapp">
            <svg viewBox="0 0 32 32" fill="#25d366" width="36">
               <path d="M 16,2 C 8.2680079,2 2,8.2680053 2,16 2,23.731995 8.2680079,30 16,30 23.731992,30 30,23.731995 30,16 30,8.2680053 23.731992,2 16,2 Z" fill="#fff"></path>
                <path d="M 16 1 C 7.714844 1 1 7.71484 1 16 C 1 24.28516 7.714844 31 16 31 C 24.285156 31 31 24.28516 31 16 C 31 7.71484 24.285156 1 16 1 z M 15.826172 7.96875 C 17.719967 7.9190994 19.609469 8.5444916 21.119141 9.8046875 C 24.251463 12.419388 24.922373 16.966902 22.673828 20.349609 C 21.35021 22.340858 19.208051 23.635369 16.826172 23.884766 C 16.289167 23.940993 15.212259 23.90964 14.738281 23.824219 C 13.934021 23.679273 13.258955 23.465333 12.552734 23.130859 L 12.193359 22.960938 L 10.144531 23.498047 C 9.0180753 23.79335 8.0754821 24.035156 8.0488281 24.035156 C 8.0221746 24.035156 7.9998695 24.021696 8 24.005859 C 8.000096 23.990023 8.2492788 23.069482 8.5527344 21.960938 L 9.1035156 19.945312 L 8.9023438 19.542969 C 7.372748 16.484356 7.9255017 12.863186 10.300781 10.392578 C 10.924939 9.7433704 11.6449 9.2195778 12.494141 8.796875 C 13.552189 8.2702394 14.689895 7.9985404 15.826172 7.96875 z M 15.896484 9.3183594 C 14.280513 9.3509895 12.677611 9.9703301 11.441406 11.169922 C 10.819174 11.773725 10.410007 12.336431 10.054688 13.074219 C 9.0784067 15.10138 9.1903409 17.458003 10.357422 19.388672 C 10.453152 19.547035 10.532851 19.712452 10.533203 19.755859 C 10.533539 19.799266 10.394964 20.341707 10.224609 20.960938 C 10.054254 21.580168 9.9280422 22.100094 9.9453125 22.117188 C 9.9625823 22.134281 10.495452 22.012921 11.128906 21.845703 C 11.76236 21.678486 12.316185 21.541487 12.359375 21.541016 C 12.402565 21.540536 12.61012 21.635573 12.820312 21.751953 C 13.515098 22.136644 14.317945 22.40404 15.125 22.519531 C 15.672283 22.597849 16.72143 22.568401 17.265625 22.460938 C 19.313646 22.056509 21.027607 20.754669 21.958984 18.892578 C 23.292575 16.226351 22.666178 12.98848 20.427734 10.988281 C 19.142242 9.8396084 17.512456 9.2857292 15.896484 9.3183594 z M 13.398438 12.248047 C 13.690698 12.247778 13.85018 12.302382 13.933594 12.429688 C 14.051098 12.609023 14.679687 14.177516 14.679688 14.291016 C 14.679688 14.449536 14.568539 14.64278 14.279297 14.988281 C 14.140282 15.154336 14.027341 15.32567 14.027344 15.371094 C 14.027355 15.552239 14.682081 16.444515 15.091797 16.820312 C 15.582564 17.270452 16.269579 17.700422 16.837891 17.912109 C 17.007093 17.975135 17.027281 17.974924 17.117188 17.916016 C 17.170255 17.881244 17.343528 17.69297 17.503906 17.498047 C 18.023563 16.866461 17.961155 16.919637 18.154297 16.941406 C 18.342782 16.962651 19.918558 17.714868 20.011719 17.828125 C 20.051765 17.87681 20.060192 17.971843 20.044922 18.208984 C 20.022075 18.563771 19.922439 18.865285 19.765625 19.052734 C 19.596505 19.254893 19.250926 19.494809 18.941406 19.625 C 18.683166 19.733621 18.606544 19.747361 18.193359 19.759766 C 17.82738 19.770753 17.676379 19.759365 17.462891 19.701172 C 16.760643 19.509755 15.828554 19.105949 15.296875 18.761719 C 13.991747 17.91673 12.491111 16.13101 12.113281 14.974609 C 11.81718 14.068352 11.993186 13.222995 12.607422 12.589844 C 12.885638 12.30306 13.008745 12.248403 13.398438 12.248047 z"></path>
            </svg>
        </a>
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=ivanheral.github.io/tutorial/2016/07/30/tutorial-grafo-twitter-con-riot-d3.html&title=Tutorial. Grafo social Twitter con Riot y D3&source=/files/images/desarrollo/riot.jpg" title="Compartir en LinkedIn">
            <svg viewBox="0 0 32 32" fill="#0077b5" width="36">
                <path d="M 16,2 C 8.2680079,2 2,8.2680053 2,16 2,23.731995 8.2680079,30 16,30 23.731992,30 30,23.731995 30,16 30,8.2680053 23.731992,2 16,2 Z" fill="#fff"></path>
                <path d="M 14.750337,30.980631 C 11.17024,30.656347 7.8226318,29.093744 5.3272841,26.582118 3.1212435,24.361686 1.7152719,21.645388 1.1520474,18.515682 1.0164827,17.762381 0.99864679,17.462107 0.99997912,15.955503 1.0016539,14.142483 1.051403,13.682363 1.3950298,12.307035 1.8987338,10.291011 2.9195695,8.237465 4.2442783,6.575391 6.2514462,4.057055 9.1924166,2.166258 12.316314,1.385751 c 1.375328,-0.343626 1.835447,-0.39344797 3.648467,-0.39504997 1.506605,-0.0013 1.806879,0.01651 2.56018,0.15206897 3.129706,0.563223 5.846004,1.969195 8.066436,4.175236 2.294872,2.279998 3.737464,5.132894 4.28353,8.471189 0.165625,1.012553 0.166777,3.312326 0.0022,4.363097 -1.03618,6.614843 -6.081773,11.68267 -12.647554,12.703277 -0.663339,0.10311 -2.852718,0.181807 -3.47922,0.125061 z M 12.1085,17.941284 l 0.01683,-5.10395 h -1.667343 c -1.4598428,0 -1.6723022,0.01293 -1.7071891,0.103836 -0.073098,0.190488 -0.045297,9.872703 0.028701,10.01105 0.065564,0.122505 0.1396105,0.127346 1.6903771,0.110564 l 1.62181,-0.01754 z m 5.333309,1.920136 c 0.03246,-3.148941 0.0345,-3.187143 0.18248,-3.487575 0.186714,-0.37897 0.529009,-0.736132 0.887956,-0.926511 0.217563,-0.115392 0.385427,-0.146254 0.800464,-0.147153 0.453135,-9.3e-4 0.566391,0.02308 0.825723,0.175557 0.347514,0.204302 0.59225,0.542414 0.756127,1.044636 0.101156,0.310008 0.120242,0.738848 0.153075,3.439511 l 0.03751,3.085346 h 1.641137 1.641143 v -3.544863 c 0,-3.505479 -0.0017,-3.550667 -0.151193,-4.067071 -0.43951,-1.518032 -1.401927,-2.465659 -2.802862,-2.75979 -1.357005,-0.284908 -2.577712,0.05401 -3.45786,0.960048 -0.240985,0.248071 -0.45405,0.451045 -0.473468,0.451045 -0.01944,0 -0.0438,-0.273246 -0.05421,-0.607222 l -0.0189,-0.607221 h -1.673914 -1.673964 l -0.01696,5.021893 c -0.0093,2.76204 -0.0027,5.059328 0.01475,5.10508 0.02476,0.06477 0.399095,0.0793 1.690934,0.06564 l 1.659179,-0.01754 z m -6.039402,-8.654896 c 0.402282,-0.209419 0.573796,-0.379057 0.773722,-0.765257 C 12.418167,9.973719 12.416447,9.330638 12.171929,8.856 11.839233,8.210295 11.286981,7.913907 10.416554,7.913907 c -1.1085148,0 -1.8525148,0.704625 -1.8530653,1.754996 -3.725e-4,0.742231 0.4383106,1.366358 1.1529114,1.640214 0.1214466,0.04654 0.4565609,0.07404 0.7998319,0.06564 0.472865,-0.01156 0.649783,-0.04518 0.886216,-0.168237 z"></path>
            </svg>
        </a>
    </div>
</div>
  <div class="post-content" itemprop="articleBody">
    <p>Sin que sirva de precedente, crearemos un generador de grafos interactivo de la red social twitter con la librería gráfica D3 y un framework tan peculiar y desconocido como Riot.</p>

<p>Tendremos un formulario para añadir usuarios de twitter dibujando un bonito grafo de nodos y links. Los nodos representaran a los usuarios y los links representaran la conexiones que tienen entre ellos (follow - follower). Podremos ir agregando uno a uno y ver como nuestro grafo va creciendo de tamaño de forma interactiva.</p>

<div class="elem"> 
    
    
    
        <div class="wall_overflow gif">
        <img class="gif" src="//media2.giphy.com/media/uvqSTLjUe9u2Q/giphy_s.gif" /></div> 
     
     
    
        <div class="title-photo">
            <p>Este tutorial nos permitirá comprender las relaciones que se producen en el mundo sin movernos de casa</p>
        </div> 
     
</div>

<p><strong>1º objetivo:</strong> Obtener la informacion que nos hace falta mediante la API de twitter. Usaremos node.js (express &amp; cors) y <a href="https://www.npmjs.com/package/twitter" target="_blank">twitter</a>. Lo importante ahora mismo es mostrar la estructura de carpetas y ficheros que usaremos para llegar la idea a buen puerto:</p>

<pre>
    <code class="language-files">
Riotjs/ /* Carpeta raiz */
--- app/ /* Carpeta app */
-------- app.js
-------- routes.js
-------- twitter.js
-------- tags/ /* Carpeta tags de Riot.js */
-------------- app.tag
-------------- more_options.tag
-------------- index.js
--- public/ /* Carpeta public */
-------- index.html
--- package.json
--- webpack.config.js
--- server.js
    </code>    
</pre>

<p><strong>package.json:</strong> Aquí tendremos todo lo necesario para que funcione nuestro invento. Usaremos express, cors y twitter para crear los servicios. El resto nos permitirá trabajar con Riot.js y D3: he pensado en <a href="https://github.com/esnunes/riotjs-loader">riotjs-loader</a> &amp; webpack para contruir nuestro bundle:</p>
<pre>
    <code class="language-json">
{
  "name": "riot-webpack",
  "version": "1.0.0",
  "description": "",
  "main": "bundle.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" &amp;&amp; exit 1",
    "start": "webpack-dev-server --inline --hot",
    "bundle": "webpack"
  },
  "author": "",
  "license": "ISC",
  "dependencies": {
    "d3": "3.5.17",
    "riot": "~2.6.2",
    "twitter": "^1.4.0"
  },
  "devDependencies": {
    "babel-core": "^6.13.2",
    "babel-loader": "^6.2.4",
    "riotjs-loader": "^3.0.0",
    "superagent": "^2.3.0",
    "webpack": "^1.13.1",
    "webpack-dev-server": "^1.14.1",
    "cors": "^2.8.1",
    "express": "^4.14.0"
  }
}
    </code>    
</pre>

<p>He decidido usar superagent para conectar correctamente con los servicios por que se adapta bastante bien a Riot. Ok, lanzamos este comando para instalarlo todo:</p>
<pre>
    <code class="language-bash">
npm install
    </code>    
</pre>

<div class="post-title page">Node.js</div>

<p><strong>server.js:</strong> Este fichero se encargara de arrancar nuestros servicios usando express y cors en el puerto 4500. En las carpetas app tendremos el cliente twitter con las keys (os presto las mías) y las rutas:</p>
<pre>
    <code class="language-js">
var express = require("express"),
    app = express(),
    cors = require("cors"),
    client = require('./app/twitter');

var router = express.Router();
app.use(cors());
app.use('/', router);
/* Routes */
require('./app/routes')(router, client);
app.listen(4500);
exports = module.exports = app;
    </code>    
</pre>

<p><strong>app/twitter.js:</strong> Las claves que comente anteriormente para poder acceder a la api de twitter y que almacenaremos en la variable <strong>client</strong>:</p>
<pre>
    <code class="language-js">
var Twitter = require('twitter');

var client = new Twitter({
    consumer_key: '20WaLvRtAfgNaidtVj75bEyQq'
    , consumer_secret: '3hwKEd3Q39OiAPtGKomjOU1u5SL45i6yDic5BfttLPxmhMdrYL'
    , access_token_key: '1072055204-FqweRykJv3h8KAtmG8IE3PSOqnGroEXEasp8eEG'
    , access_token_secret: 'o8VC0TDlclmRAMPUWMFygh2DSaFASh8C0GHYNu6PzkX6O'
});

module.exports = client;
    </code>    
</pre>

<p><strong>app/routes.js:</strong> Aquí estarán las rutas, en nuestro caso solo tendremos dos. Una para obtener la información de perfil de cada usuario que queramos agregar en nuestro grafo y otra para comprobar si están relacionados con los otros usuarios anteriores:</p>

<pre>
    <code class="language-js">
// app/router.js
module.exports = function (router, client) {

/* Aqui iran los dos servicios */

}
    </code>    
</pre>

<p><strong>1º servicio:</strong> Necesitamos informacion del usuario que incluyamos en nuestro grafo. Tendremos que usar <a href="https://dev.twitter.com/rest/reference/get/users/show">users/show</a> de la API twitter para extraer su identificador, su nick/nombre y la url de su avatar/imagen:</p>
<pre>
    <code class="language-js">
    router.route('/user/:name').get(function (req, res) {
    /* Usamos de parametro name (example: localhost:4500/user/ivanheral) */
        var params = {
            screen_name: req.params.name
        };
        client.get('users/show', params, function (error, user) {
            if (!error) {
               console.log({
                    "id": user.id_str,
                    "screen_name": user.screen_name
                    , "name": user.name
                    , "img": user.profile_image_url
                });
            /* Devolvemos un json con el id, nick, nombre y imagen del usuario de twitter */
            res.json({
                    "id": user.id_str,
                    "screen_name": user.screen_name
                    , "name": user.name
                    , "img": user.profile_image_url
                });
            }
        });
    });
        </code>    
</pre>

<p><strong>2º servicio:</strong> Necesitamos comprobar si dos usuarios de twitter se siguen mutuamente. Bastara con usar <a href="https://dev.twitter.com/rest/reference/get/friendships/show">users/show</a> de la API twitter para comprobar si podemos conectar ambos usuarios con un link:</p>
<pre>
    <code class="language-js">
    router.route('/links/:user_1/:user_2/:x/:y').get(function (req, res) {
        /* Usamos los nombres user_1 y user_2 en params */
        var params = {
            source_screen_name : req.params.user_1
            , target_screen_name: req.params.user_2
        };
        client.get('friendships/show', params, function (error, tweets, response) {
            if (!error) {
                /* Condicion que comprueba si se siguen mutuamente */
                if (tweets.relationship.target.following &amp;&amp; tweets.relationship.target.followed_by) {
                    /* Exito! Devuelvo true y la posicion que tienen en nuestro acumulado particular */
                    res.json({"relation": true, "pos_x":req.params.x, "pos_y":req.params.y});
                } else res.json({"relation": false});
            }
        });
    });
        </code>    
</pre>

<p>Ok, con esto bastaria para tener montado nuestro particular servidor. Ya solo tendriamos que lanzarlo con un <strong>node server</strong> y probar en nuestro navegador escribiendo esta url: <strong>localhost:4500/user/perezreverte</strong> para ver si funciona correctamente.</p>

<div class="post-title page">Webpack</div>

<p><strong>webpack.config.js:</strong> Este es el fichero webpack con la configuración pertinente. El comando <strong>npm run bundle</strong> construira nuestro bundle.js mientras que <strong>npm run start</strong> nos permitirá lanzarlo en caliente mientras modificamos el proyecto:</p>
<pre>
    <code class="language-js">
var webpack = require('webpack');
/* compilamos el fichero app/app.js en public/bundle.js */
module.exports = {
    context: __dirname + '/app'
    , entry: './app.js'
    , output: {
        path: __dirname + '/public'
        , filename: 'bundle.js'
    }
    /* importante incluir riot, d3 y superagent en nuestro bundle */
    , plugins: [
    new webpack.ProvidePlugin({
            riot: 'riot', d3: 'd3'
            , request: 'superagent'
        })
  ]
    , module: {
        preLoaders: [
            {
                test: /\.tag$/, exclude: /node_modules/
                , loader: 'riotjs-loader'
      }
    ]
    }
    /* servidor */
    , devServer: {
        contentBase: './public'
    }
};
        </code>    
</pre>

<p><strong>public/index.html:</strong> la estructura es muy sencilla con estilos bootstrap. Lo único a destacar es la etiqueta <strong>app</strong> que sera indispensable para montar los componentes de Riot:</p>
<pre>
    <code class="language-html">
&lt;!DOCTYPE html&gt;
&lt;html lang=""&gt;
&lt;head&gt;
    &lt;meta charset="UTF-8"&gt;
    &lt;meta name="viewport" content="width=device-width, initial-scale=1.0"&gt;
    &lt;meta name="description" content=""&gt;
    &lt;meta name="author" content=""&gt;
    &lt;title&gt;Social Graph Twitter&lt;/title&gt;
    &lt;link rel="shortcut icon" href=""&gt;
    &lt;link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"&gt;
    &lt;link rel="stylesheet" href="style.css"&gt;
&lt;/head&gt;
&lt;body&gt;
    &lt;app&gt;&lt;/app&gt;
    &lt;script src="bundle.js"&gt;&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;    
</code>
</pre>

<p><strong>app/app.js:</strong> La columna vertebral del proyecto donde incluimos riot, superagent y los tags. Finalmente montamos el 1º componente <strong>social-twitter</strong> en la etiqueta <strong>app</strong> de <strong>public/index.html</strong></p>

<pre>
    <code class="language-js">
var riot = require('riot');
var request = require('superagent');
require('./tags');

riot.mount('app','social-twitter')
        </code>    
</pre>

<p><strong>tags/index.js:</strong>Capitan Obvius al rescate!, fichero que no necesita mucha explicación al respecto, simplemente incluyo todos los tags que se encuentran en la carpeta del mismo nombre para que <strong>app.js</strong> los incluya con un simple <strong>require(‘./tags’)</strong>:</p>
<pre>
    <code class="language-js">
require('./more_options.tag')
require('./app.tag')
        </code>    
</pre>

<p><strong>tags/app.tag:</strong> Esto es lo que vendría a ser nuestro primer componente de Riot mencionado anteriormente como <strong>social-twitter</strong>. Por una parte tenemos los estilos propios (css) junto al html (un formulario con una función <strong>add</strong>) y finalmente el javascript (ES6) que ira al final del todo. En el siguiente paso iré incluyendo lo necesario para que funcione:</p>
<pre>
    <code class="language-html">
&lt;social-twitter&gt;
&lt;style&gt;
.options {background: #ddd;}
form {padding: 5px 5px;}
&lt;/style&gt;
&lt;div class='container options'&gt;
&lt;form class='form-inline'&gt;
  &lt;div class='form-group'&gt;
    &lt;input name='user' class='form-control'&gt;
  &lt;button type='submit' class='btn btn-primary' onclick={add}&gt;ADD USER TWITTER&lt;/button&gt;
  &lt;/div&gt;
  &lt;options nodes_list={nodes} links_list={links}&gt;&lt;/options&gt;
&lt;/form&gt;
&lt;/div&gt;

/* codigo javascript que explicare por pasos a continuación */

&lt;/social-twitter&gt;
        </code>    
</pre>

<div class="post-title page">D3</div>

<p>Ok, comenzamos con javascript. Definimos el ancho y alto que tendrá nuestro componente svg para visualizar nuestro grafo (1800/820px en nuestro caso). Ahora mismo esta calibrado para monitores FullHD pero podéis modificar <strong>public/style.css</strong> para adecuarlo a vuestro monitor:</p>
<pre>
    <code class="language-js">
let self = this
let width = 1800
, height = 820
        </code>    
</pre>

<p>Incluimos las dimensiones a nuestra etiqueta <strong>app</strong> para que tenga constancia de sus dimensiones:</p>
<pre>
    <code class="language-js">
self.svg = d3.select('app')
.append('div')
.attr('class','container graph')
.append('svg').attr('width', width)
.attr('height', height)
        </code>    
</pre>

<p>Aplicamos force layout a nuestro d3 indicándole algunas propiedades como pueden ser la gravedad hacia el centro o la distancia entre nodos:</p>
<pre>
    <code class="language-js">
self.force = d3.layout.force().
gravity(0.1).distance(100).
charge(-100).size([width, height])
        </code>    
</pre>

<p>¿Como interpreta force layout &amp; d3 la información? pues… os pongo un ejemplo. Alex de la Iglesia y Nacho vigalondo se siguen mutuamente en twitter. Por lo tanto, la variable <strong>links</strong> contendra un link con source y target apuntando a 0 y 1 que son las posiciones de la lista de nodos que tendremos en la variable <strong>nodes</strong>:</p>
<pre>
    <code class="language-json">
{
    "nodes": [{
        "id": "5793642"
        , "name": "Nacho Vigalondo"
        , "img": "http://pbs.twimg.com/profile_images/782341301551325184/pTkWiFy2_normal.jpg"
        , "screen_name": "vigalondo"
        , "index": 0
    }, {
        "id": "43310939"
        , "name": "De la Iglesia"
        , "img": "http://pbs.twimg.com/profile_images/752006649255198720/-3MXvi1k_normal.jpg"
        , "screen_name": "alexdelaIglesia"
        , "index": 1
    }]
    , "links": [{
        "source": 0
        , "target": 1
    }]
}
    </code>    
</pre>

<p>Teniendo en cuenta lo anterior, pasamos a crear una lista de nodos y links para acumular los usuarios y relaciones que obtengamos tras escribirlos en el formulario:</p>
<pre>
    <code class="language-js">
self.nodes = []
self.links = []
        </code>    
</pre>

<p>Incluimos dos funciones que aplicaremos a los nodos para poder fijarlos en el area como si fueran chinchetas. Con doble click volveran a su posicion original:</p>
<pre>
    <code class="language-js">
this.dblclick = function(d) {
  d3.select(this).classed('fixed', d.fixed = false);
}

this.dragstart = function(d) {
  d3.select(this).classed('fixed', d.fixed = true);
}
</code>
</pre>

<p>Aplicamos force a los nodos y links. Editamos los nodos para que se muestren con la imagen y nombre del usuario correspondiente. A los links se les aplicara los estilos de la clase link y los nodos dispondran las funciones anteriormente mencionadas:</p>
<pre>
    <code class="language-js">
self.force.nodes(self.nodes).links(self.links)
self.link = self.svg.selectAll('.link').data(self.links).enter().append('line').attr('class', 'link')
self.node = self.svg.selectAll('.node').data(self.nodes).enter().append('g').attr('class', 'node').call(self.force.drag).on('dragstart', this.dragstart).on('dblclick', this.dblclick)

self.node.append('image').attr('xlink:href', function (d) {
                return d.img
            }).attr('x', -12).attr('y', -12).attr('width', 24).attr('height', 24).append('text').attr('x', 0).attr('dy', '26px').attr('text-anchor', 'middle').text(function (d) {
        return d.name})   
        </code>
</pre>

<p>Mediante tick conseguiremos que nuestros nodos cobren vida y se muevan libremente:</p>
<pre>
    <code class="language-js">
self.force.on('tick', function () {
        self.link.attr('x1', function (d) {
            return d.source.x;
        }).attr('y1', function (d) {
            return d.source.y;
        }).attr('x2', function (d) {
            return d.target.x;
        }).attr('y2', function (d) {
            return d.target.y;
        });
        self.node.attr('transform', function (d) {
            return 'translate(' + d.x + ',' + d.y + ')'
        });
})
</code>
</pre>

<p>Esta función se encargara de refrescar los nodos &amp; links cada vez que añadamos un nuevo usuario. Les aplicara todas las propiedades necesarias para que funcionen del mismo modo que el resto:</p>
<pre>
    <code class="language-js">
self.start=function(e) {
    self.link = self.link.data(self.force.links())
    self.node = self.node.data(self.force.nodes())
    self.link.enter().insert('line', '.node').attr('class', 'link')
    var aux = self.node.enter().insert('g').attr('class', 'node')
    aux.append('image').attr('xlink:href', function (d) {
            return d.img
        }).attr('x', -12).attr('y', -12).attr('width', 24).attr('height', 24)
    aux.append('text').attr('x', 0).attr('dy', '26px').attr('text-anchor', 'middle').text(function (d) {
        return d.name
    })
    self.link.exit().remove()
    self.node.exit().remove()
    self.node.call(self.force.drag).on('dragstart', this.dragstart).on('dblclick', this.dblclick)
    self.force.nodes(self.nodes).links(self.links).start()    
}
</code>
</pre>

<p>Finalmente terminamos con la logica del componente <strong>social-twitter</strong>, concretamente la funcion add que se ejecuta al pulsar el boton <strong>ADD USER TWITTER</strong>:</p>
<pre>
    <code class="language-js">
self.add=function(e) {
/* Obtenemos el nick del usuario de twitter */
self.add_aux(self.user.value)
}    
    
self.add_aux=function(name) {
/* usamos superagent y tiramos del servicio */
request.get( 'http://localhost:4500/user/'+name, function(err,res) {
    
    /* Lo guardamos todo en la variable new_node */
    var new_node = {
        id: res.body.id,
        name: res.body.name,
        img: res.body.img,
        screen_name: res.body.screen_name
    }

    /* Agregamos el nodo en nodes */
    self.nodes.push(new_node)
    
    /* En cuanto agregamos el 1º nodo... refrescamos! */
    if (self.nodes.length==1) {self.start()}
    /* Vaya... tenemos que actualizar nuestras variables nodes y links */
    self.update()
    
    /* Comprobamos si el nuevo nodo tiene relaciones con los que
    estaban anteriormente agregados */
    for(i=0; i&lt;self.nodes.length-1; i++) {
        let size = self.nodes.length-1
        request.get( 'http://localhost:4500/links/'+self.nodes[i].screen_name+'/'+self.nodes[self.nodes.length-1].screen_name+'/'+i+'/'+size, 
        function(err,res) {
        /* Si hay relacion, agregamos link */
        if (res.body!=null &amp;&amp; res.body.relation) {
                self.links.push({
                    source: parseInt(res.body.pos_x)
                    , target: parseInt(res.body.pos_y)
                }) 
                /* Relacion encontrada! toca refrescar */
                self.start()
            }
        })
    }
})
/* clear */
self.user.value = ''
}
</code>
</pre>
<p>Y aqui termina el tutorial por mi parte, solo teneis que lanzar desde la carpeta Riotjs un <strong>node server</strong> y abrir <strong>Public/index.html</strong> para cacharrear un poco (se me olvido que teneis que lanzar un <strong>npm run bundle</strong> para que funcione correctamente). Quedaría explicar el 2º componente de nombre <strong>more_options</strong>, componente hijo de <strong>social-twitter</strong> y responsable del guardado, carga y reseteo de nuestras creaciones. Es mejor descargarse el codigo que dejo al final del post como siempre digo.</p>

<div class="elem"> 
    
        <div class="wall_overflow">
        <img src="http://img.youtube.com/vi/Ita5o7g3RkQ/mqdefault.jpg" id="Ita5o7g3RkQ" />
        </div> 
    
    
     
     
    
        <div class="title-photo">
            <p>Ejemplo de la versión final con opción para guardar, cargar y resetear grafos</p>
        </div> 
     
</div>

<p><strong>Advertencias:</strong> Es importante recalcar que las peticiones a la API Twitter son limitadas. Recomiendo salvar vuestras creaciones cada 15-20 usuarios para no perder el progreso. Otra recomendacion es que os hagais usuario de twitter para solicitar unas keys y access tokens en <a href="https://apps.twitter.com/">https://apps.twitter.com/</a>. Ahora mismo os presto mis permisos pero probablemente acabe petando si mucha gente le da por usarlo.</p>

<p><a class="btn" href="https://www.dropbox.com/s/esyc3jln6yo8hd0/Riotjs.zip?dl=0" target="_blank">
Codigo del Tutorial
</a></p>

  </div>
  
  <div class="disqus"><div id="disqus_thread"></div></div>
  
    </div>

</article></div>
    </div>
    <script type="text/javascript" src="/js/app.js"></script>
    <script type="text/javascript" src="/js/ga-lite.js "></script> 
</body>
<div class="fade-modal">
    <div id="modal">       
    </div>
 </div>
 <div class="fade"></div>
</html>