<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1 initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Tutorial. Todo App con Ember y Mongo</title>
    <meta name="description" content="Tutorial. Todo App con Ember y Mongo">
    <link rel="stylesheet" href=" /css/app.css ">
    <link rel="canonical" href="ivanheral.github.io/tutorial/2016/06/10/app-ember-mongo.html">
    <link rel="apple-touch-icon" sizes="57x57" href="/files/images/favicon/apple-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/files/images/favicon/apple-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/files/images/favicon/apple-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/files/images/favicon/apple-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/files/images/favicon/apple-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/files/images/favicon/apple-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/files/images/favicon/apple-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/files/images/favicon/apple-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/files/images/favicon/apple-icon-180x180.png">
    <link rel="icon" type="image/png" sizes="192x192" href="/files/images/favicon/android-icon-192x192.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/files/images/favicon/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="96x96" href="/files/images/favicon/favicon-96x96.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/files/images/favicon/favicon-16x16.png">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="msapplication-TileImage" content="/ms-icon-144x144.png">
    <meta name="theme-color" content="#ffffff">
    <script type="text/javascript">
        var disqus_shortname = 'ivanheral';
        var disqus_identifier = "/tutorial/2016/06/10/app-ember-mongo.html";
    </script>
    <!-- Enables twitter cards on posts -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@ivanheral" />
<meta name="twitter:title" content="Tutorial. Todo App con Ember y Mongo" />
<meta name="twitter:description" content="Tutorial. Todo App con Ember y Mongo" />
<meta name="twitter:url" content="ivanheral.github.io/tutorial/2016/06/10/app-ember-mongo.html" />
<meta name="twitter:image" content="ivanheral.github.io/files/images/desarrollo/ember.jpg" />
</head>
<body>
    <div class="wrapper">
        <div class="container"><div class="tags">
    <div class="title">
        <a class="site-title" href="/">BLOG</a>
        <div id="search">
            <input id="search_input" type="text" placeholder="..." maxlength="5">
        </div>
    </div>
    <div class="categories" id="links">
        <div class="link" id="cine">Cine
            <span>3</span>
        </div>
        <div class="link" id="random">Random
            <span>2</span>
        </div>
        <div class="link" id="opinion">Opini√≥n
            <span>5</span>
        </div>
        <div class="link" id="tutorial">Tutorial
            <span>9</span>
        </div>
        <a class="link return" id="blog">Volver al post</a>
    </div>
</div>
<div class="post-list"></div>
<article class="post" itemscope itemtype="http://schema.org/BlogPosting">
<div class="article">
    <header class="elem important">
      <div class="wall_img">
      
      <img src="/files/images/desarrollo/ember.jpg"/>
      
      </div>
   <div class="info_post">
    <div class="post-title post" itemprop="name headline">Tutorial. Todo App con Ember y Mongo</div>
    <div class="post-meta">
    <span itemprop="author" itemscope itemtype="http://schema.org/Person"></span><span itemprop="name">ivanheral,</span>
    <time datetime="2016-06-10T16:00:00+02:00" itemprop="datePublished"> 
10 
Junio
  
        2016</time>

       </div>
</div>
  </header>
    <div class="share-page">
    <div class="social-media-list">
        <a href="https://twitter.com/intent/tweet?text=Tutorial. Todo App con Ember y Mongo&url=http://ivanheral.github.io/tutorial/2016/06/10/app-ember-mongo.html">
            <svg viewBox="0 0 32 32" fill="#1da1f2" width="36">
                <path d="M 16,2 C 8.2680079,2 2,8.2680053 2,16 2,23.731995 8.2680079,30 16,30 23.731992,30 30,23.731995 30,16 30,8.2680053 23.731992,2 16,2 Z" fill="#fff"></path>
                <path d="M 16,1 C 7.7157227,1 1,7.71572 1,16 1,24.28428 7.7157227,31 16,31 24.284277,31 31,24.28428 31,16 31,7.71572 24.284277,1 16,1 Z m 7.45541,11.17617 c 0.0074,0.165 0.01113,0.33094 0.01113,0.4977 0,5.0833 -3.869238,10.94496 -10.944844,10.94496 -2.172363,0 -4.1943748,-0.63686 -5.8967576,-1.7284 0.3009375,0.0357 0.6071484,0.0539 0.9176367,0.0539 1.8022852,0 3.4609569,-0.615 4.7774999,-1.64678 -1.68334,-0.0309 -3.1039452,-1.14316 -3.593496,-2.67141 0.2349024,0.0449 0.4758985,0.0691 0.72375,0.0691 0.3508594,0 0.690762,-0.0472 1.013438,-0.13506 -1.759688,-0.35349 -3.0857231,-1.90816 -3.0857231,-3.77197 0,-0.0162 0,-0.0323 3.5e-4,-0.0484 0.5185547,0.28811 1.1117579,0.46119 1.7422852,0.48118 -1.0321875,-0.68983 -1.7113477,-1.86727 -1.7113477,-3.20192 0,-0.705 0.1897266,-1.36582 0.5208985,-1.93389 1.8972656,2.32735 4.7317391,3.85875 7.9287311,4.01924 -0.06557,-0.2816 -0.09961,-0.57515 -0.09961,-0.87668 0,-2.12437 1.722421,-3.84662 3.846797,-3.84662 1.106425,0 2.10621,0.46711 2.807871,1.21471 0.876211,-0.17244 1.699454,-0.4926 2.442774,-0.93346 -0.287227,0.8983 -0.897188,1.65217 -1.691367,2.12824 0.778125,-0.093 1.519511,-0.29976 2.209336,-0.60568 -0.515451,0.77133 -1.167599,1.44885 -1.919356,1.99119 z"></path>
            </svg>
        </a>
        <a href="https://facebook.com/sharer.php?u=ivanheral.github.io/tutorial/2016/06/10/app-ember-mongo.html" rel="nofollow" target="_blank" title="Compartir en Facebook">
            <svg viewBox="0 0 32 32" fill="#3b5998" width="36">
                <path d="M 16,2 C 8.2680079,2 2,8.2680053 2,16 2,23.731995 8.2680079,30 16,30 23.731992,30 30,23.731995 30,16 30,8.2680053 23.731992,2 16,2 Z" fill="#fff"></path>
                <path d="M 16 1 C 7.7157227 1 1 7.71572 1 16 C 1 24.28428 7.7157227 31 16 31 C 24.284277 31 31 24.28428 31 16 C 31 7.71572 24.284277 1 16 1 z M 18.220703 8.9140625 L 19.433594 8.9140625 L 19.433594 10.189453 L 19.433594 11.462891 L 18.636719 11.472656 C 17.779565 11.483924 17.67147 11.497903 17.478516 11.595703 C 17.353545 11.659021 17.271471 11.750554 17.212891 11.896484 C 17.168061 12.009479 17.168333 12.03027 17.158203 12.873047 C 17.150928 13.346665 17.150391 13.7418 17.150391 13.75 C 17.153718 13.75825 17.674335 13.765625 18.306641 13.765625 L 19.457031 13.765625 L 19.445312 13.849609 C 19.439383 13.89588 19.379257 14.469009 19.310547 15.125 L 19.183594 16.320312 L 18.158203 16.320312 L 17.134766 16.320312 L 17.134766 19.703125 C 17.134766 21.563327 17.148438 23.085938 17.148438 23.085938 L 14.068359 23.085938 L 14.068359 20.007812 L 14.068359 16.320312 L 13.306641 16.320312 L 12.542969 16.320312 L 12.542969 15.042969 L 12.542969 13.765625 L 13.304688 13.765625 L 14.064453 13.765625 L 14.074219 12.730469 C 14.084268 11.66864 14.094057 11.525352 14.179688 11.103516 C 14.263218 10.691927 14.451439 10.255344 14.673828 9.9589844 C 15.112819 9.3740849 15.82538 9.031279 16.789062 8.9375 C 16.915264 8.925205 17.512171 8.9140625 18.220703 8.9140625 z"></path>
            </svg>
        </a>
        <a href="https://plus.google.com/share?url=ivanheral.github.io/tutorial/2016/06/10/app-ember-mongo.html" rel="nofollow" target="_blank" title="Compartir en Google+">
            <svg viewBox="0 0 32 32" fill="#dd4b39" width="36">
                <path d="M 16,2 C 8.2680079,2 2,8.2680053 2,16 2,23.731995 8.2680079,30 16,30 23.731992,30 30,23.731995 30,16 30,8.2680053 23.731992,2 16,2 Z" fill="#fff"></path>
                <path d="M 16,1 C 7.7148437,1 1,7.71484 1,16 1,24.28516 7.7148437,31 16,31 24.285156,31 31,24.28516 31,16 31,7.71484 24.285156,1 16,1 Z m -3.75,22.5 c -4.1484375,0 -7.5,-3.35156 -7.5,-7.5 0,-4.14844 3.3515625,-7.5 7.5,-7.5 2.027344,0 3.720703,0.73828 5.027344,1.96289 l -2.039063,1.95703 c -0.55664,-0.5332 -1.529297,-1.1543 -2.988281,-1.1543 -2.5605469,0 -4.6523438,2.1211 -4.6523438,4.73438 0,2.61328 2.0917969,4.73437 4.6523438,4.73437 2.970703,0 4.083984,-2.13281 4.253906,-3.23437 l -4.253906,0 0,-2.57227 7.083984,0 c 0.06445,0.375 0.117188,0.75 0.117188,1.24219 0,4.28906 -2.871094,7.33008 -7.201172,7.33008 z m 13.125,-7.5 0,1.875 -1.875,0 0,-1.875 -1.875,0 0,-1.875 1.875,0 0,-1.875 1.875,0 0,1.875 1.875,0 0,1.875 -1.875,0 z"></path>
            </svg>
        </a>
        <a href="whatsapp://send?text=ivanheral.github.io/tutorial/2016/06/10/app-ember-mongo.html" data-action="share/whatsapp/share" title="Compartir en Whatsapp">
            <svg viewBox="0 0 32 32" fill="#25d366" width="36">
               <path d="M 16,2 C 8.2680079,2 2,8.2680053 2,16 2,23.731995 8.2680079,30 16,30 23.731992,30 30,23.731995 30,16 30,8.2680053 23.731992,2 16,2 Z" fill="#fff"></path>
                <path d="M 16 1 C 7.714844 1 1 7.71484 1 16 C 1 24.28516 7.714844 31 16 31 C 24.285156 31 31 24.28516 31 16 C 31 7.71484 24.285156 1 16 1 z M 15.826172 7.96875 C 17.719967 7.9190994 19.609469 8.5444916 21.119141 9.8046875 C 24.251463 12.419388 24.922373 16.966902 22.673828 20.349609 C 21.35021 22.340858 19.208051 23.635369 16.826172 23.884766 C 16.289167 23.940993 15.212259 23.90964 14.738281 23.824219 C 13.934021 23.679273 13.258955 23.465333 12.552734 23.130859 L 12.193359 22.960938 L 10.144531 23.498047 C 9.0180753 23.79335 8.0754821 24.035156 8.0488281 24.035156 C 8.0221746 24.035156 7.9998695 24.021696 8 24.005859 C 8.000096 23.990023 8.2492788 23.069482 8.5527344 21.960938 L 9.1035156 19.945312 L 8.9023438 19.542969 C 7.372748 16.484356 7.9255017 12.863186 10.300781 10.392578 C 10.924939 9.7433704 11.6449 9.2195778 12.494141 8.796875 C 13.552189 8.2702394 14.689895 7.9985404 15.826172 7.96875 z M 15.896484 9.3183594 C 14.280513 9.3509895 12.677611 9.9703301 11.441406 11.169922 C 10.819174 11.773725 10.410007 12.336431 10.054688 13.074219 C 9.0784067 15.10138 9.1903409 17.458003 10.357422 19.388672 C 10.453152 19.547035 10.532851 19.712452 10.533203 19.755859 C 10.533539 19.799266 10.394964 20.341707 10.224609 20.960938 C 10.054254 21.580168 9.9280422 22.100094 9.9453125 22.117188 C 9.9625823 22.134281 10.495452 22.012921 11.128906 21.845703 C 11.76236 21.678486 12.316185 21.541487 12.359375 21.541016 C 12.402565 21.540536 12.61012 21.635573 12.820312 21.751953 C 13.515098 22.136644 14.317945 22.40404 15.125 22.519531 C 15.672283 22.597849 16.72143 22.568401 17.265625 22.460938 C 19.313646 22.056509 21.027607 20.754669 21.958984 18.892578 C 23.292575 16.226351 22.666178 12.98848 20.427734 10.988281 C 19.142242 9.8396084 17.512456 9.2857292 15.896484 9.3183594 z M 13.398438 12.248047 C 13.690698 12.247778 13.85018 12.302382 13.933594 12.429688 C 14.051098 12.609023 14.679687 14.177516 14.679688 14.291016 C 14.679688 14.449536 14.568539 14.64278 14.279297 14.988281 C 14.140282 15.154336 14.027341 15.32567 14.027344 15.371094 C 14.027355 15.552239 14.682081 16.444515 15.091797 16.820312 C 15.582564 17.270452 16.269579 17.700422 16.837891 17.912109 C 17.007093 17.975135 17.027281 17.974924 17.117188 17.916016 C 17.170255 17.881244 17.343528 17.69297 17.503906 17.498047 C 18.023563 16.866461 17.961155 16.919637 18.154297 16.941406 C 18.342782 16.962651 19.918558 17.714868 20.011719 17.828125 C 20.051765 17.87681 20.060192 17.971843 20.044922 18.208984 C 20.022075 18.563771 19.922439 18.865285 19.765625 19.052734 C 19.596505 19.254893 19.250926 19.494809 18.941406 19.625 C 18.683166 19.733621 18.606544 19.747361 18.193359 19.759766 C 17.82738 19.770753 17.676379 19.759365 17.462891 19.701172 C 16.760643 19.509755 15.828554 19.105949 15.296875 18.761719 C 13.991747 17.91673 12.491111 16.13101 12.113281 14.974609 C 11.81718 14.068352 11.993186 13.222995 12.607422 12.589844 C 12.885638 12.30306 13.008745 12.248403 13.398438 12.248047 z"></path>
            </svg>
        </a>
        <a href="https://www.linkedin.com/shareArticle?mini=true&url=ivanheral.github.io/tutorial/2016/06/10/app-ember-mongo.html&title=Tutorial. Todo App con Ember y Mongo&source=/files/images/desarrollo/ember.jpg" title="Compartir en LinkedIn">
            <svg viewBox="0 0 32 32" fill="#0077b5" width="36">
                <path d="M 16,2 C 8.2680079,2 2,8.2680053 2,16 2,23.731995 8.2680079,30 16,30 23.731992,30 30,23.731995 30,16 30,8.2680053 23.731992,2 16,2 Z" fill="#fff"></path>
                <path d="M 14.750337,30.980631 C 11.17024,30.656347 7.8226318,29.093744 5.3272841,26.582118 3.1212435,24.361686 1.7152719,21.645388 1.1520474,18.515682 1.0164827,17.762381 0.99864679,17.462107 0.99997912,15.955503 1.0016539,14.142483 1.051403,13.682363 1.3950298,12.307035 1.8987338,10.291011 2.9195695,8.237465 4.2442783,6.575391 6.2514462,4.057055 9.1924166,2.166258 12.316314,1.385751 c 1.375328,-0.343626 1.835447,-0.39344797 3.648467,-0.39504997 1.506605,-0.0013 1.806879,0.01651 2.56018,0.15206897 3.129706,0.563223 5.846004,1.969195 8.066436,4.175236 2.294872,2.279998 3.737464,5.132894 4.28353,8.471189 0.165625,1.012553 0.166777,3.312326 0.0022,4.363097 -1.03618,6.614843 -6.081773,11.68267 -12.647554,12.703277 -0.663339,0.10311 -2.852718,0.181807 -3.47922,0.125061 z M 12.1085,17.941284 l 0.01683,-5.10395 h -1.667343 c -1.4598428,0 -1.6723022,0.01293 -1.7071891,0.103836 -0.073098,0.190488 -0.045297,9.872703 0.028701,10.01105 0.065564,0.122505 0.1396105,0.127346 1.6903771,0.110564 l 1.62181,-0.01754 z m 5.333309,1.920136 c 0.03246,-3.148941 0.0345,-3.187143 0.18248,-3.487575 0.186714,-0.37897 0.529009,-0.736132 0.887956,-0.926511 0.217563,-0.115392 0.385427,-0.146254 0.800464,-0.147153 0.453135,-9.3e-4 0.566391,0.02308 0.825723,0.175557 0.347514,0.204302 0.59225,0.542414 0.756127,1.044636 0.101156,0.310008 0.120242,0.738848 0.153075,3.439511 l 0.03751,3.085346 h 1.641137 1.641143 v -3.544863 c 0,-3.505479 -0.0017,-3.550667 -0.151193,-4.067071 -0.43951,-1.518032 -1.401927,-2.465659 -2.802862,-2.75979 -1.357005,-0.284908 -2.577712,0.05401 -3.45786,0.960048 -0.240985,0.248071 -0.45405,0.451045 -0.473468,0.451045 -0.01944,0 -0.0438,-0.273246 -0.05421,-0.607222 l -0.0189,-0.607221 h -1.673914 -1.673964 l -0.01696,5.021893 c -0.0093,2.76204 -0.0027,5.059328 0.01475,5.10508 0.02476,0.06477 0.399095,0.0793 1.690934,0.06564 l 1.659179,-0.01754 z m -6.039402,-8.654896 c 0.402282,-0.209419 0.573796,-0.379057 0.773722,-0.765257 C 12.418167,9.973719 12.416447,9.330638 12.171929,8.856 11.839233,8.210295 11.286981,7.913907 10.416554,7.913907 c -1.1085148,0 -1.8525148,0.704625 -1.8530653,1.754996 -3.725e-4,0.742231 0.4383106,1.366358 1.1529114,1.640214 0.1214466,0.04654 0.4565609,0.07404 0.7998319,0.06564 0.472865,-0.01156 0.649783,-0.04518 0.886216,-0.168237 z"></path>
            </svg>
        </a>
    </div>
</div>
  <div class="post-content" itemprop="articleBody">
    <p>Hoy he decidido revivir una serie de posts publicados a mediados de abril del a√±os pasado (<a href="http://ryanchristiani.com/working-with-ember-data-node-express-and-mongodb/">1</a>,<a href="programwitherik.com/how-to-setup-your-ember-project-with-mongo-and-node/">2</a>,<a href="programwitherik.com/how-to-add-records-with-mongo-and-ember/">3</a>,<a href="programwitherik.com/how-to-edit-or-delete-with-mongo-and-ember/">4</a>). Fueron unos 4 posts escritos por <a href="www.twitter.com/RChristiani">Ryan Christiani</a> y <a href="www.twitter.com/ErikCH">Erik Hanchett</a> muy interesanter sobre como utiliar Mongo con el framework Ember 1.X. Lamentablemente dejaron de funcionar tras el lanzamiento de la version 2.0 del framework Ember dejando inservibles los post mencionados. Hoy reviviremos estos post y aprenderemos a realizar una especie de Todo-App que nos permita listar, a√±adir, modicar y borrar notas en Mongo usando este simpatico pero en ocasiones cambiante framework.</p>

<div class="post-title page">1¬∫ Parte: La Api</div>

<p>Ok. Primero contruiremos una api que haga peticiones de la base de datos. Es importante instalar mongo y nodejs con un simple <strong>sudo apt-get install nodejs &amp;&amp; mongo</strong>, recomiendo instalar Robomongo 0.8.5 para visualizar los registros. Lo siguiente sera crear una carpeta de nombre Tutorial-Ember (por ejemplo) y dentro creamos una de nombre Api que tendra la siguiente estructura de archivos y carpetas. A continuacion, enumeramos la estructura de ficheros que tendra:</p>

<pre>
    <code class="language-bash">
carpeta api
   - note.js
   
carpeta app
   - routes.js 
      
carpeta models      
   - note.js 
    
package.json
server.json    
    </code>    
</pre>

<p><strong>package.json:</strong> Usaremos express y moongose principalmente. Morgan para visualizar en la terminal si funcionan correctamente las peticiones todo correctamente. Cors y body-parser para otras cosas, no quiero profundizar al respecto XD:</p>

<pre>
<code class="language-json">
{
  "name": "Server",
  "version": "0.0.0",
  "devDependencies": {
    "body-parser": "^1.15.2",
    "cors": "^2.7.1",
    "express": "^4.14.0",
    "mongoose": "^4.5.2",
    "morgan": "^1.7.0"
  }
}
</code>    
</pre>

<p><strong>models/note.js:</strong> Vamos a crear un registro de notas/cuentos donde almacenaremos 3 campos: el titulo, el contenido y el autor en formato string:</p>
<pre>
<code class="language-js">
// models/note.js
mongoose = require('mongoose');
/* Usaremos un modelo 'note' con tres campos strings */
var noteSchema = new mongoose.Schema({
	title: 'string',
	content: 'string',
	author: 'string'
});

module.exports = mongoose.model('note',noteSchema);
</code>    
</pre>

<p><strong>app/routes.js:</strong> Aqui tendremos configuradas las 2 rutas bien diferenciadas. En api/notes tenemos un GET que recupere todas las notas y POST para agregar una nota. En /api/notes/:note_id tendremos las opciones de modificar y borrar mediante DELETE y PATCH:</p>
<pre>
<code class="language-js">
// app/router.js

var notes = require('../api/note');
module.exports = function (router) {

    /* Ruta de listado de nota (get) y salvado de nuevas notas (post) */ 
    router.route('/api/notes').get(function (req, res) {
            notes.getAllNotes(req, res)
        })
        .post(function (req, res) {
            notes.addNote(req, res)
        });
        
    /* Ruta de borrado (delete) y modificado (patch) */     
    router.route('/api/notes/:note_id').get(function (req, res) {
            notes.getIdNote(req, res)
        })
        .delete(function (req, res) {
            notes.deleteNote(req, res)
        })
        .patch(function (req, res) {
            notes.saveNote(req, res)
        });
};
</code>    
</pre>

<p><strong>api/note.js:</strong> Aqui estan las 4 funcionalidades que enlazan a la ruta correspondiente. <strong>getAllNotes</strong> devuetve un listado de todas las notas en la variable note. <strong>getIdNote</strong> busca la nota por el identificador que recibe como parametro de la ruta. <strong>deleteNote</strong> borra en funcion del identificador recibido y <strong>addNote</strong> a√±ade una nota:</p>
<pre>
<code class="language-js">
var Note = require('../models/note');

/* Enviara la lista de notas en una variable 'note' */
module.exports.getAllNotes = function (req, res) {
    Note.find({}, function (err, docs) {
        if (err) res.send(err)
        console.log(docs);
        res.send({
            note: docs
        });
    });
};

/* Buscara la nota gracias a req.params.note_id y nos devolvera
la nota en una variable 'note' */
module.exports.getIdNote = function (req, res) {
    Note.findById(req.params.note_id, function (err, docs) {
        if (err) res.send(err);
        console.log(docs);
        res.send({
            note: docs
        });
    });
};

/* Eliminado de nota */
module.exports.deleteNote = function (req, res) {
    Note.findById(req.params.note_id, function (err, elem) {
        if (err) res.send(err);
        elem.remove(function (err, docs) {
            if (err) res.send(err);
            console.log(docs);
            res.send({
                note: docs
            });
        });
    });
};

/* Salvar nota */
module.exports.addNote = function (req, res) {
    var note = new Note(req.body.note);
    note.save(function (err, elem) {
        if (err) res.send(err);
        console.log(elem);
        res.send({
            note: elem
        });
    });
};

/* Modificar nota ($set: req.body.note) */
module.exports.saveNote = function (req, res) {
    Note.findByIdAndUpdate(req.params.note_id, {
        $set: req.body.note
    }, function (err, elem) {
        if (err) res.send(err);
        console.log(elem);
        res.send({
            note: elem
        });
    });
};
</code>    
</pre>

<p><strong>server.js:</strong> Finalmente terminamos con el servidor. El servidor se ejecutara por el puerto 4500. La cosa quedaria como muestro a continuacion:</p>

<pre>
<code class="language-js">
/* Variables */
var express = require("express")
    , app = express();

var morgan = require('morgan');
var bodyParser = require('body-parser');
var cors = require('cors');
var router = express.Router();


/* Conectamos a la BBDD  de Mongo */
mongoose = require('mongoose');
mongoose.connect('mongodb://localhost/emberData');


app.use(morgan('dev'));
app.use(bodyParser.json());

app.use(cors());


/* USAR RUTAS */
app.use('/', router);
require('./app/routes')(router);

/* Puerto */
app.listen(4500);
console.log("Node server running on http://localhost:4500");

exports = module.exports = app;
</code>    
</pre>

<p>Bueno, ahora toca probar nuestra API. Abrimos una terminal en la carpeta Api y ejecutamos <strong>npm install</strong>. Despues lanzamos <strong>node server</strong> y dejamos que funcione en el puerto 4500. Solo nos queda probar si funciona ejecutando los siguientes comandos en otra terminal estando siempre pendiente de los mensajes que puedan salir en la terminal con el mensaje <strong>Node server running on http://localhost:4500</strong>:</p>
<pre>
<code class="language-bash">
// ADD note
curl -d '{"note":{"title":"Oliver Twist","content":"Oliver es un ni√±o hu√©rfano.","author": "Charles Dickens"}}' -H "Content-Type: application/json" http://localhost:4500/api/notes

// GET ALL
curl http://localhost:4500/api/notes

// DELETE note
curl -X DELETE -H "Content-Type: application/json" http://localhost:4500/api/notes/(_id reemplazar por el identificador correcto)

/* Si aparecen 200/204 de color verde es que la cosa va bien
Morgan y los mensajes de la terminal te guiaran. */
</code>    
</pre>

<div class="post-title page">2¬∫ Parte: El framework</div>

<p>¬øHa funcionado correctamente? si la respuesta es afirmativa entonces pasaremos a la segunda parte. EmberJs es un framework bastante interesante que mediante comandos por terminal nos permitira generar plantillas, rutas y controladores de manera sencilla y rapida. Pero lo primero es instalarlo:</p>
<pre>
<code class="language-bash">
// Instalamos Ember (este tutorial utiliza la version 2.6.2)
sudo npm install -g ember-cli@2.6.2
// En la carpeta Tutorial-Ember abrimos una terminal y lanzamos un nuevo proyecto:
ember new Example
</code>    
</pre>

<p>Estupendo, metamonos dentro de la carpeta Example y abramos una terminal. En el siguiente paso se describen los comandos que nos ahorraran escribir:</p>

<pre>
<code class="language-bash">
// 1¬∫ Creamos la ruta MADRE
// g (generate -  generar) &amp; d (deploy - remover)
ember g route application

// 2¬∫ Creamos la ruta index y about (Aqui agregaremos y listaremos notas)
ember g route index
ember g route about

// 3¬∫ Creamos la ruta note/show (Aqui modificaremos y borraremos notas)
ember g route note/show

// 4¬∫ Generamos el modelo note (title,content.author)
ember g model note title:string content:string author:string

// 5¬∫ Generamos el serializer para que conecte con el id de Mongo.
ember g serializer application

// 6¬∫ Generamos el adaptador para que nuestro proyecto Ember apunte a la Api.
ember g adapter application

// 7¬∫ Generamos los controladores donde incluiremos las acciones
ember g controller index
ember g controller note/show

// 8¬∫ Instalar Bootstrap 4 (addon)
bower install tether
ember install ember-cli-sass
ember install ember-bootstrap-4
</code>    
</pre>

<p>Ha sido relativamente sencillo pero ahora queda lo realmente dificil, rellenar los ficheros generados, nos centraremos en la carpeta app que se aloja en <strong>Example</strong>. <strong>app/styles/app.scss: </strong>Necesitamos agregar bootstrap en la hoja de estilos del proyecto y renombar a *.scss el fichero de estilos:</p>
<pre>
<code class="language-scss">
@import "bootstrap";

/* ejemplo de estilo propio */

.padding-top {
    padding-top: 2rem;
}
</code>    
</pre>

<p><strong>Example/app/adapters/application.js:</strong> Fichero para conectar la api con nuestro framework. Le asignamos un nombre, un host para que apunte al puerto de nuestra api y incluimos unos headers para la correcta lectura del json tras las peticiones que hagamos:</p>
<pre>
<code class="language-js">
import JSONAPIAdapter from 'ember-data/adapters/json-api';

export default JSONAPIAdapter.extend({
    namespace: 'api',
    host: 'http://localhost:4500',
    headers: {"Content-Type":"application/json"}
});
</code>    
</pre>

<p><strong>app/router.js:</strong> Aqui se configuran las rutas. Index apuntara a la url ‚Äú/‚Äù y about apuntara a ‚Äú/about‚Äù:</p>
<pre>
<code class="language-js">
import Ember from 'ember';
import config from './config/environment';

const Router = Ember.Router.extend({
  location: config.locationType
});

Router.map(function() {
  this.route('about', {path: "/about"});
  this.route('index', {path: "/"});
  /* En la carpeta note se encuentra el template show que recibira un parametro id */
  this.resource('note', function() {
      this.route('show', {
          path: ":note_id"
      });
    });
});

export default Router;
</code>    
</pre>

<p><strong>app/serializers/application.js:</strong> Este fichero sera modificado debido a que la libreria <strong>RESTSerializer</strong> funciona correctamente para asignar una clave primaria a los _id de los registros que se extraen de Mongo:</p>
<pre>
<code class="language-js">
import DS from 'ember-data';

export default DS.RESTSerializer.extend({
	primaryKey: '_id'
});
</code>    
</pre>

<p><strong>app/templates/routes/index.js:</strong> Devuelve una variable model con todas las notas registradas en Mongo.</p>
<pre>
<code class="language-js">
import Ember from 'ember';

export default Ember.Route.extend({
	model: function() {
		return this.store.findAll('note');
	}
});
</code>    
</pre>

<p><strong>app/templates/application.hbs:</strong> Esta es la ruta Madre de donde tiraran el resto de vistas. Aqui se ha incluido exclusivamente la cabecera y en outlet se dibujara la vista que se considere oportuno en funcion de la url en la que estemos:</p>
<pre>
<code class="language-html">
&lt;nav class="navbar navbar-dark navbar-full bg-primary"&gt;
  &lt;button class="navbar-toggler hidden-sm-up" type="button" data-toggle="collapse" data-target="#exCollapsingNavbar2"&gt;
    &#9776;
  &lt;/button&gt;
  &lt;div class="collapse navbar-toggleable-xs" id="exCollapsingNavbar2"&gt;
    &lt;a class="navbar-brand" href="#"&gt;Todo App - Ember&lt;/a&gt;
    &lt;ul class="nav navbar-nav"&gt;
      &lt;li class="nav-item active"&gt;
        {{#link-to 'about' class="nav-link"}}ABOUT{{/link-to}}
      &lt;/li&gt;      
    &lt;/ul&gt;
  &lt;/div&gt;
&lt;/nav&gt;
{{outlet}}
</code>  
</pre>

<p><strong>app/templates/index.hbs:</strong> Primer template de nuestra App. Constara de un formulario que tras un submit lanzara la accion save del controlador index. Lo siguiente que vereis es el listado mediante un each que devuelve un item para visualizar las notas:</p>
<pre>
<code class="language-html">
&lt;div class="container"&gt;
    &lt;div class="row"&gt;    
        &lt;div class="col-xs-12 col-md-3 padding-top"&gt;
            &lt;form {{action 'save' on="submit" }}&gt;
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Titulo:&lt;/label&gt;{{textarea value=titulo class="form-control"}} &lt;/div&gt;
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Contenido:&lt;/label&gt;{{textarea rows=10 value=contenido class="form-control"}} &lt;/div&gt;
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Autor:&lt;/label&gt;{{textarea value=autor class="form-control"}} &lt;/div&gt;
                &lt;button class="btn btn-primary"&gt;a√±adir&lt;/button&gt;
            &lt;/form&gt;
        &lt;/div&gt;        
        &lt;div class="col-xs-12 col-md-9 padding-top"&gt;
            &lt;div class="row"&gt;               
               {{#each model as |item|}}
               
                &lt;div class="col-xs-12 col-sm-6 col-md-4"&gt;
                    &lt;div class="card text-xs-right"&gt;                           
                        &lt;img class="img-fluid card-img-top" src="assets/images/ember.jpg"&gt;
                            &lt;div class="card-block"&gt;
                                &lt;h4 class="card-title"&gt;{{item.title}}&lt;/h4&gt; 
                                &lt;p&gt;{{item.content}}&lt;/p&gt;
                                &lt;p&gt;{{item.author}}&lt;/p&gt;
                                {{#link-to 'note.show' item.id class="btn btn-primary" tagName="button" }}
                                ver
                                {{/link-to}}
                            &lt;/div&gt;                            
                    &lt;/div&gt;
                &lt;/div&gt;                 
                {{/each}} 
            &lt;/div&gt;          
        &lt;/div&gt;        
    &lt;/div&gt;
&lt;/div&gt;
</code>  
</pre>

<p><strong>app/controllers/index.js:</strong>El controlador de index dispone de la accion <strong>save</strong> que hemos visto anteriormente en el formulario. Gracias a <strong>createRecord</strong> podemos salvar una nota extrayendo el valor de los textareas. Reseteamos el formulario y guardamos:</p>
<pre>
<code class="language-js">
import Ember from 'ember';

export default Ember.Controller.extend({

actions: {
        save: function () {
            var note = this.store.createRecord('note', {
                title: this.get('titulo'),
                content: this.get('contenido'),
                author: this.get('autor')
            });	    
	        this.set('titulo', "");
            this.set('contenido', "");
            this.set('autor', "");
            note.save();
        }
    }
});
</code>    
</pre>

<p><strong>app/templates/note/show.hbs:</strong> Esta vista es un formulario que dibuja los campos de la nota escogida con tres posibles acciones mediante botones (borrar, modificar y Index):</p>
<pre>
<code class="language-html">
&lt;div class="container"&gt;
    &lt;div class="row"&gt;
        &lt;div class="col-xs-12 col-sm-6 padding-top"&gt;
            &lt;form&gt;
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Titulo:&lt;/label&gt;
                    {{textarea value=model.title cols="40" rows="1" class="form-control"}}
                &lt;/div&gt;
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Contenido:&lt;/label&gt;
                    {{textarea value=model.content cols="40" rows="10" class="form-control"}}
                &lt;/div&gt;
                &lt;div class="form-group"&gt;
                    &lt;label&gt;Autor:&lt;/label&gt;
                    {{textarea value=model.author cols="40" rows="1" class="form-control"}}
                &lt;/div&gt;
                &lt;div class="btn-group"&gt;
                    &lt;button type="delete" class="btn btn-danger" {{action 'delete' on='click' }}&gt;borrar&lt;/button&gt;
                    &lt;button type="submit" class="btn btn-success" {{action 'update' on='click' }}&gt;modificar&lt;/button&gt;
                    {{#link-to 'index' tagName="button" class="btn btn-primary"}}Index{{/link-to}}
                &lt;/div&gt;
            &lt;/form&gt;
        &lt;/div&gt;
    &lt;/div&gt;
&lt;/div&gt;
</code>    
</pre>

<p><strong>Example/app/controllers/note/show.js:</strong> Este controlador tiene dos acciones (borrado y modificado). Tras realizar su cometido, nos reenviaran a la home mediante <strong>transitionToRoute(‚Äòindex‚Äô)</strong>.</p>
<pre>
<code class="language-js">
import Ember from 'ember';
export default Ember.Controller.extend({
    actions: {
        delete: function () {
            /* Borrado */
            this.get('model').deleteRecord();
            this.get('model').save();
            this.transitionToRoute('index');
        },
        update: function () {
            /* Seleccionamos la nota */
            var note_selected = this.get('model');
            /* Reescribimos */
            note_selected.save();
            this.transitionToRoute('index');
        }
    }
});
</code>    
</pre>

<div class="elem">
    
    <div class="wall_overflow">
        <img src="http://img.youtube.com/vi/4p8_aYyKtx8/mqdefault.jpg" id="4p8_aYyKtx8" />
    </div>
    
    
    
    
    
    
    <div class="title-photo">
        <p>Video del resultado final</p>
    </div>
    
</div>

<p><strong>Conclusiones del paso de Ember 1.x a 2.x:</strong> En Ember 2.x usan PATCH y no PUT para modificaciones, muy raro. Muchas librerias han sido reemplazadas sin repercutir en el funcionamiento exceptuando serializer. Incluir los headers en el adaptador es mas sencillo que modificar el environment. Ha sido un poco desesperante pero finalmente ha funcionado mejor de lo que esperaba. Dejo el codigo por si le interesa a alguien:</p>

<p><a class="btn" href="http://www.dropbox.com/s/ntrmv8j1226rbhz/Tutorial-Ember.zip?dl=0" target="_blank">
Codigo del Tutorial
</a></p>

  </div>
  
  <div class="elem"><div id="disqus_thread" class="disqus"></div></div>
  
    </div>

</article></div>
    </div>
    <script type="text/javascript" src="/js/app.js"></script>
    <script type="text/javascript" src="/js/ga-lite.js "></script> 
</body>
<div class="fade-modal">
    <div id="modal">       
    </div>
 </div>
 <div class="fade"></div>
</html>